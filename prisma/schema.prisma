// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  String         @id @default(uuid())
  name                String 
  hash                String? 
  serverName          String?
  email               String         @unique 
  accountType         String  
  unipersonal         Unipersonal?
  company             Company?
  student             Student?
  tags                Tag[]
  bill                Bill?
  refreshToken        UserRefreshToken?
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @default(now())

  @@map("users")
}

model Bill {
  id                  Int           @id @default(autoincrement())
  services            Json  
  amount              Decimal
  nextBillableDay     DateTime
  note                String
  payment             Payment?
  user                User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId              String     
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @default(now())

  @@map("bills")
}

model Payment {
  id                  Int             @id @default(autoincrement())
  paymentStatus       String   
  amount              Decimal      
  paymentStartedAt    DateTime
  paymentDeadline     DateTime
  bill                Bill            @relation(fields: [billId], references: [id])
  billId              Int
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @default(now())

  @@map("payments")
}

model Unipersonal {
  id                  String              @id @default(uuid())
  phone               String
  address             Address?
  user                User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId              String         
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @default(now())

  @@map("unipersonal_info")
}

model Company {
  id                  String              @id @default(uuid())
  name                String
  phone               String
  address             Address?
  employees           Employee[]
  user                User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId              String         
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @default(now())

  @@map("conpany_info")
}

model Student {
  id                  String              @id @default(uuid())
  verified            Boolean
  phone               String
  bornAt              String
  schoolName          String
  studentId           String
  address             Address?
  user                User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId              String         
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @default(now())

  @@map("student_info")
}

model Employee {
  id                  String              @id @default(uuid())
  verified            Boolean
  name                String
  email               String              @unique
  phone               String?
  hash                String
  tags                Tag[]
  employer            Company            @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId           String         
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @default(now())

  @@map("employee_info")
}

model Address {
  id                  String          @id @default(uuid())
  country             String
  provinceOrState     String          
  city                String
  address1            String
  address2            String
  postcode            String
  unipersonal         Unipersonal?    @relation(fields: [unipersonalId], references: [id], onDelete: Cascade)
  unipersonalId       String?  
  company             Company?       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId           String?  
  student             Student?       @relation(fields: [studentId], references: [id], onDelete: Cascade)
  studentId           String?
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @default(now())

  @@map("addresses")
}

model UserRefreshToken {
  id                  String           @id @default(uuid())
  expiresIn           Int
  user                User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId              String

  @@map("user_refresh_token")
}

model Tag {
  id                  String          @id
  title               String          @unique
  users               User[]
  employees           Employee[]
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @default(now())

  @@map("tags")
}

// MozEconomia Admin
model meAdmin {
  id                  String         @id @default(uuid())
  name                String 
  email               String         @unique  
  hash                String 
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @default(now())

  @@map("me_admins")
}